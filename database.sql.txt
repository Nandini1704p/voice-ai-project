-- 1. Remove old tables if they exist
DROP TABLE IF EXISTS campaigns CASCADE;
DROP TABLE IF EXISTS programs CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS organizations CASCADE;

-- 2. Create Organizations Table
CREATE TABLE organizations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- For System
    custom_id VARCHAR(50) UNIQUE,                  -- For You (e.g., 'org-1')
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(100) UNIQUE NOT NULL,
    industry VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 3. Create Users Table
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    custom_user_id VARCHAR(50) UNIQUE,             -- For You (e.g., 'user-1')
    organization_id UUID REFERENCES organizations(id) ON DELETE CASCADE,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    display_name VARCHAR(200),
    role VARCHAR(30) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 4. Create Programs Table
CREATE TABLE programs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    organization_id UUID REFERENCES organizations(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    program_type VARCHAR(100),
    intake_period VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 5. Insert Sample Data
WITH new_org AS (
    INSERT INTO organizations (custom_id, name, slug, industry) 
    VALUES ('org-1', 'Global Institute of Management', 'gim-2026', 'Education')
    RETURNING id
)
INSERT INTO users (custom_user_id, organization_id, email, password_hash, display_name, role)
SELECT 'user-1', id, 'admin@gim.com', 'hashed_password', 'Dr. Sarah', 'admin' FROM new_org;